<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LawPay Test Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1d4ed8;
        }
        .info-box {
            background-color: #f0f9ff;
            border: 1px solid #3b82f6;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .test-cards {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .code {
            background-color: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>LawPay Test Integration</h1>
        
        <form id="paymentForm">
            <div class="form-group">
                <label for="amount">Amount ($)</label>
                <input type="number" id="amount" name="amount" value="100.00" step="0.01" min="0.01" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <input type="text" id="description" name="description" value="Legal Services - Test Payment" required>
            </div>
            
            <div class="form-group">
                <label for="clientName">Client Name</label>
                <input type="text" id="clientName" name="clientName" value="Test Client" required>
            </div>
            
            <div class="form-group">
                <label for="clientEmail">Client Email</label>
                <input type="email" id="clientEmail" name="clientEmail" value="test@example.com" required>
            </div>
            
            <div class="form-group">
                <label for="accountType">Account Type</label>
                <select id="accountType" name="accountType">
                    <option value="operating">Operating Account</option>
                    <option value="trust">Trust Account</option>
                </select>
            </div>
            
            <button type="submit">Pay with LawPay</button>
        </form>
        
        <div class="info-box">
            <h3>Integration Details</h3>
            <p>Public Key: <span class="code">m_fteOuPIGRwOu7nZRKhaBcw</span></p>
            <p>Environment: <strong>Test Mode</strong></p>
            <p>This will create a payment session and redirect to LawPay's hosted checkout.</p>
        </div>
        
        <div class="test-cards">
            <h3>Test Cards</h3>
            <p><strong>Success:</strong> 4111 1111 1111 1111</p>
            <p><strong>Decline:</strong> 4000 0000 0000 0002</p>
            <p>Use any future expiry date and any 3-digit CVV</p>
        </div>
    </div>

    <script>
        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const button = e.target.querySelector('button');
            button.disabled = true;
            button.textContent = 'Processing...';
            
            const formData = {
                amount: parseFloat(document.getElementById('amount').value),
                description: document.getElementById('description').value,
                clientName: document.getElementById('clientName').value,
                clientEmail: document.getElementById('clientEmail').value,
                trustAccount: document.getElementById('accountType').value === 'trust'
            };
            
            try {
                // First, create a payment session with our backend
                const response = await fetch('/api/payment/lawpay-webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to create payment session');
                }
                
                const data = await response.json();
                
                // For now, we'll build the LawPay URL manually
                // In production, this would come from the API response
                const lawPayParams = new URLSearchParams({
                    public_key: 'm_fteOuPIGRwOu7nZRKhaBcw',
                    amount: (formData.amount * 100).toString(),
                    currency: 'USD',
                    description: formData.description,
                    reference: data.paymentId,
                    client_name: formData.clientName,
                    client_email: formData.clientEmail,
                    account_type: formData.trustAccount ? 'trust' : 'operating',
                    success_url: window.location.origin + '/payment/success?reference=' + data.paymentId,
                    cancel_url: window.location.origin + '/payment/cancel?reference=' + data.paymentId
                });
                
                // LawPay test environment URL
                const lawPayUrl = 'https://secure-test.lawpay.com/checkout?' + lawPayParams.toString();
                
                console.log('Redirecting to LawPay:', lawPayUrl);
                alert('Redirecting to LawPay test environment...\n\nPayment ID: ' + data.paymentId);
                
                // In production, uncomment this to redirect:
                // window.location.href = lawPayUrl;
                
            } catch (error) {
                console.error('Payment error:', error);
                alert('Error: ' + error.message);
            } finally {
                button.disabled = false;
                button.textContent = 'Pay with LawPay';
            }
        });
    </script>
</body>
</html>